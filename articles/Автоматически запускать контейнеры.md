# Автоматически запускать контейнеры

Docker предоставляет [политики перезапуска](https://docs.docker.com/engine/reference/run/#restart-policies---restart), чтобы контролировать, будут ли ваши контейнеры запускаться автоматически при выходе или при перезапуске Docker. Политики перезапуска гарантируют, что связанные контейнеры запускаются в правильном порядке. Docker рекомендует использовать политики перезапуска и избегать использования менеджеров процессов для запуска контейнеров.

Политики перезапуска отличаются от флага `--live-restore` команды` dockerd`. Использование `--live-restore` позволяет поддерживать работу ваших контейнеров во время обновления Docker, хотя работа с сетью и ввод данных пользователем прерываются.

## Используйте политику перезагрузки

Чтобы настроить политику перезапуска для контейнера, используйте флаг `--restart` при использовании команды `docker run`. Значение флага `--restart` может быть любым из следующих:

| Флаг | Описание |
| --- | --- |
|  `no`  | Не перезапускать контейнер автоматически. (по умолчанию) |
|  `on-failure`  | Перезапустите контейнер, если он вышел из-за ошибки, которая проявляется как ненулевой код выхода. |
|  `always`  | Всегда перезапускайте контейнер, если он останавливается. Если он остановлен вручную, он перезапускается только при перезапуске демона Docker или при перезапуске самого контейнера вручную. (См. Второй пункт в списке [подробности политики перезапуска](https://docs.docker.com/config/containers/start-containers-automatically/#restart-policy-details) ) |
|  `unless-stopped`  | Подобно `Always`, за исключением того, что когда контейнер останавливается (вручную или иным образом), он не перезапускается даже после перезапуска демона Docker. |

В следующем примере запускается контейнер Redis и настраивается его постоянный перезапуск, если он не был явно остановлен или перезапущен Docker.

```
$ docker run -dit --restart unless-stopped redis

```

### Перезапустите детали политики

Помните следующее при использовании политик перезапуска:

* Политика перезапуска вступает в силу только после успешного запуска контейнера. В этом случае успешный запуск означает, что контейнер работает не менее 10 секунд, и Docker начал его мониторинг. Это предотвращает переход контейнера, который вообще не запускается, в цикл перезапуска.
    
* Если вы остановите контейнер вручную, его политика перезапуска будет игнорироваться до тех пор, пока не будет перезапущен демон Docker или контейнер не будет перезапущен вручную. Это еще одна попытка предотвратить перезапуск цикла.
    
* Политики перезапуска применяются только к _containers_. Политики перезапуска для служб роя настроены по-разному. Смотрите [флаги, связанные с перезапуском службы](https://docs.docker.com/engine/reference/commandline/service_create/) .
    

## Используйте менеджер процессов

Если политики перезапуска не соответствуют вашим потребностям, например, когда процессы вне Docker зависят от контейнеров Docker, вы можете использовать диспетчер процессов, например [upstart](http://upstart.ubuntu.com/) , [systemd](http://freedesktop.org/wiki/Software/systemd/) , или же [supervisor](http://supervisord.org/) вместо.

>  **Предупреждение**: не пытайтесь объединять политики перезапуска Docker с администраторами процессов на уровне хоста, поскольку это создает конфликты.

Чтобы использовать диспетчер процессов, настройте его для запуска вашего контейнера или службы, используя ту же команду `docker start` или `docker service`, которую вы обычно используете для запуска контейнера вручную. Обратитесь к документации для конкретного менеджера процессов для получения более подробной информации.

### Использование диспетчера процессов внутри контейнеров

Диспетчеры процессов также могут запускаться в контейнере, чтобы проверить, запущен ли процесс, и запустить / перезапустить его, если нет.

> **Предупреждение**: Они не поддерживают Docker и просто отслеживают процессы операционной системы внутри контейнера.
>
> Docker не рекомендует такой подход, поскольку он зависит от платформы и даже отличается в разных версиях данного дистрибутива Linux.

**********
[docker](/tags/docker.md)
