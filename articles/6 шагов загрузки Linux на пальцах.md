# 6 шагов загрузки Linux на пальцах

![](/images/46adf270b3f267673c569ff3658a51ce.png)

Нажмите кнопку включения питания на вашем системнике, и спустя несколько секунд вы увидите окно входа в систему.  
  
Посмею предположить, что каждого интересовало хоть когда-либо то, что происходит за занавесом заставок и загрузочных экранов с момента включения питания компьютера к моменту, когда предлагается войти в систему.  
  
Я предлагаю вам познакомиться со следующими уровнями типичной загрузки Linux:  
  

#### 1\. BIOS

  

*   BIOS отвечает за базовый ввод/вывод данных с устройств/на устройства.
*   Делает некоторые проверки целостности устройств. К тому же, за тестирование работоспособности электроники отвечает POST (Power-on self-test, он же «тест на адекватность себя самого», выполняющийся как этап пре-загрузки), который управляется BIOS
*   Ищет, загружает и выполняет программу-загрузчик ОС
*   Берет загрузчик из флопика, сидюка или жесткого диска. Во время загрузки BIOS'а вы можете нажать на кнопку (обычно это F12 или F2 или Del, зависит от платформы), если вам требуется внести некоторые изменения касательно настройки железа.
*   Как только загрузчик был обнаружен и загружен в память, BIOS передает управление ему.
*   Короче говоря, BIOS загружает и выполняет загрузочную запись (MBR).

  

#### 2\. MBR

  

*   MBR — это главная загрузочная запись, хранящаяся на жестком диске
*   Она размещена в 1-м секторе загрузочного диска, например /dev/hda или /dev/sda
*   MBR занимает меньше, чем 512 байтов. Она состоит из трех компонентов: 1) главная загрузочная информация, «живущая» в первых 446 байтах; 2) информация о таблице разделов — в следующих 64 байтах; 3) и последние 2 байта нужны для проверки корректности mbr.
*   Она содержит информацию о GRUB'е (или LILO).
*   Простыми словами — MBR загружает и выполняет загрузчик GRUB.

  

#### 3\. GRUB

  

*   GRUB — Grand Unified Bootloader.
*   Если в вашей системе установлено более, чем одно ядро, у вас есть возможность выбирать, которое из них должен выполняться
*   GRUB отображает~красивую анимацию plymouth~заставку, и, подождав несколько секунд интерактивного воздействия пользователя, если он не нажал ни одной клавиши, он загружает ядро, установленное по умолчанию в файле конфигурации grub.
*   GRUB понимает, что такое файловая система (древние загрузчики Linux'а, например, LILO этого не понимают).
*   Конфигурационный файл Grub обычно лежит по пути /boot/grub/grub.conf (так же /etc/grub.conf может быть символьной ссылкой на него). Вот пример файла конфигурации для CentOS:  
    
    > `#boot=/dev/sda<br>default=0<br>timeout=5<br>splashimage=(hd0,0)/boot/grub/splash.xpm.gz<br>hiddenmenu<br>title CentOS (2.6.18-194.el5PAE)<br>         root (hd0,0)<br>         kernel /boot/vmlinuz-2.6.18-194.el5PAE ro root=LABEL=/<br>         initrd /boot/initrd-2.6.18-194.el5PAE.img`
    
*   В качестве примечания к информации выше, конфигурационный файл содержит путь к ядру и образу initrd
*   Если быть кратким, GRUB просто напросто загружает и выполняет образы ядра и initrd.

  

#### 4\. Ядро или Kernel

  

*   Ядро монтирует файловую систему в соответствии с настройкой «root=» в фале grub.conf
*   Выполняет программу /sbin/init
*   Поскольку init — это первый процесс, запущенный ядром Linux, поэтому она имеет идентификатор процесса (PID) №1. Можете выполнить «ps -ef | grep init» и убедиться в этом.
*   initrd — это Initial RAM Disk, он же временный диск в оперативной памяти
*   initrd используется самим ядром в качестве временной корневой файловой системы, пока kernel не загрузится в реальную примонтированную файловую систему. Этот временный диск также содержит необходимые для загрузки драйверы, позволяющие получить доступ к разделам дисков и другому оборудованию

  

#### 5\. Init

  

*   Смотрит в файл /etc/inittab для того, чтобы определить уровень выполнения (run level).
*   Есть следующие уровни выполнения:  
    *   0 – прервать выполнение
    *   1 – Однопользовательский режим, так называемый «Single user mode», или иными словами, консоль восстановления
    *   2 – Многопользовательский режим без поддержки NFS
    *   3 – Полноценный многопользовательский режим
    *   4 – не используется
    *   5 – X11
    *   6 – перезагрузка
*   Init определяет уровень выполнения по умолчанию исходя из /etc/inittab и использует его для загрузки всех необходимых программ.
*   Выполните «grep initdefault /etc/inittab» на вашей системе, и вы узнаете, какой уровень по умолчанию у вас используется
*   Если у вас не получается жить спокойно, то можете установить стандартный уровень на 0 или 6. :)
*   В большинстве случаев вам будет достаточно уровня 3 или 5.

  

#### 6\. Уровень выполнения программ (Runlevel)

  

*   Когда Линукс выполняет свою загрузку, вы можете наблюдать загрузку различных служб. К примеру, это могут быть сообщения типа «starting Postfix … OK» (запускается Postfix). Эти службы — и называются программами уровня выполнения, выполняемые из директории, которая соответствует нужному уровню выполнения.
*   Исходя из настроек по умолчанию, система будет выполнять файлы в соответствии с нижеприведенными директориями.  
    *   Выполнение уровня 0 – /etc/rc.d/rc0.d/
    *   Выполнение уровня 1 – /etc/rc.d/rc1.d/
    *   Выполнение уровня 2 – /etc/rc.d/rc2.d/
    *   Выполнение уровня 3 – /etc/rc.d/rc3.d/
    *   Выполнение уровня 4 – /etc/rc.d/rc4.d/
    *   Выполнение уровня 5 – /etc/rc.d/rc5.d/
    *   Выполнение уровня 6 – /etc/rc.d/rc6.d/
*   Но имейте ввиду, что еще в каталоге /etc могут быть символические ссылки. Например, /etc/rc0.d залинкован на /etc/rc.d/rc0.d.
*   В каталогах /etc/rc.d/rc\*.d/ вы можете увидеть список программ, имя которых начинается из букв S и K.
*   Программы, начинающиеся на S используются для запуска. S, потому что**s**tartup.
*   Программы, которые начинаются с литеры K используются — правильно — для завершения работы. K, потому что**k**ill.
*   Еще есть номера рядом с буквами S и K в именах программ. Эти номера используются для определения порядка запуска этих программ.
*   К примеру, S12syslog предназначен для запуска демона syslog, его порядковый номер 12. S80sendmail — для запуска демона sendmail, имеющего порядковый номер 80. Таким образом, программа syslog будет запущена перед sendmail.

  
  
Вот и все. Возможно, некоторым из вас это не ново и особого интереса не было при чтении статью, поскольку она более ориентирована на начально-средний уровень знакомства з Линуксом.   
В таком случае могу лишь сказать, что «повторение — мать учения» (с).  
  

#### Дополнения, исправления, уточнения

  
В комментариях неоднократно было апеллировано к тексту статьи, поэтому, думаю, стоит учесть некоторые важные комментарии хабрасообщества. (спасибо [artemlight](http://artemlight.habrahabr.ru/), [3al](http://3al.habrahabr.ru/), [Tishka17](http://tishka17.habrahabr.ru/), [HhyperH](http://hhyperr.habrahabr.ru/), [Next\_Alex](http://next_alex.habrahabr.ru/), [Ilya\_Shmelykh](http://ilya_smelykh.habrahabr.ru/), [Aux](http://aux.habrahabr.ru/), [soomrack](http://soomrack.habrahabr.ru/), [Xpeh](http://xpeh.habrahabr.ru/) )  

*   [artemlight:](http://habrahabr.ru/blogs/linux/113350/#comment_3640280): «Ну скажем прямо — так грузятся далеко не все дистры». С ним согласилось большинство, отмечая и bsd-style init, u-boot, и хоть initrd в статье пропущен, стоить заметить, что он нужен ядру не во всех дистрибутивах. Также отмечено, что в slackware поддержка rc.d осуществляется только в качестве совместимости, а встраиваемые системы грузятся иначе. На декстопах иногда бывает EFI, а кроме того Linux популярен в мире embedded и там ещё куча разных платформ. Линукс в телефоне вообще иначе грузится.
*   [soomrack](http://habrahabr.ru/blogs/linux/113350/#comment_3640776), ссылая на википедию: Еще хочется сделать замечание по поводу MBR, первого сектора и пр. Все несколько усложнилось за последние годы. Сейчас уместней говорить о EFI.  
      
    «GUID Partition Table (GPT) является стандартным форматом размещения таблиц разделов на физическом жестком диске. Он является частью Extensible Firmware Interface (EFI) (Расширяемый Микропрограммный Интерфейс) — стандарта, предложенного Intel на смену отжившего BIOS, одного из последних реликтов первозданной IBM PC. EFI использует GPT там, где BIOS использует Главную загрузочную запись (MBR)....»
*   Так же[просили вспомнить](http://habrahabr.ru/blogs/linux/113350/#comment_3640356)о LILO. LILO, ми тебя помним! Привет!
*   Xpeh[доплняет](http://habrahabr.ru/blogs/linux/113350/#comment_3640405), что «BIOS (и не упомянутый тут (U)EFI) прежде всего занимается инициализацией устройств (в том числе загрузку собственных биосов PCI-устройств), про это ничего не написано. Хотя эта роль постепенно сокращается, так как всё больше железа инициализирует себя само и/или поддерживает горячее подключение и потому всё равно инициализируется ОС, но, например, инициализацию оперативной памяти он делает всегда. „
*   VolCh[уточняет](http://habrahabr.ru/blogs/linux/113350/#comment_3640644)загрузку для ОС Debian-Ubuntu:  
    Для Debian/Ubuntu:  
    — каталога /etc/rc.d/ нет;  
    — каталоги /etc/rc?.d/ настоящие каталоги, а не ссылки;  
    — в этих каталогах хранятся ссылки на скрипты в каталоге /etc/init.d/  
      
    Вручную лучше в /etc/rc?.d/ ничего не править, а использовать команду update-rc.d, которая позволяет создавать ссылки, удалять их, запрещать (фактически переименовывать c S\* на K\*) и разрешать (c K\* на S\*) запуск.

**********
[grub](/tags/grub.md)
[загрузка](/tags/%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0.md)
[BIOS](/tags/BIOS.md)
[init](/tags/init.md)
